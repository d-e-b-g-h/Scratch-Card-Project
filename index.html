<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scratch Card</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      height: 100%; margin: 0; padding: 0;
      background: #ffecb3;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .card-container {
      position: relative;
      width: 95vw;
      max-width: 340px;
      aspect-ratio: 1/1.33;
      background: linear-gradient(135deg, #fde12e 74%, #ff542b 98%);
      border-radius: 22px;
      box-shadow: 0 12px 36px 0 #c2933a29, 0 4px 14px #fff6 inset;
      overflow: hidden;
      margin: 28px 0;
      display: flex; align-items: center; justify-content: center;
    }
    .prize-text {
      position: absolute; z-index: 2;
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      font-size: 2.1rem;
      font-weight: 900;
      letter-spacing: 1px;
      color: #d02f2f;
      opacity: 0;
      text-shadow: 0 2px 7px #fff9, 0 1px 0 #ffe;
      transition: opacity .8s cubic-bezier(.45,1,.3,1.1);
      user-select: none;
      pointer-events: none;
    }
    .prize-animate { opacity: 1 !important; animation: revealPrize .8s cubic-bezier(.45,1,.3,1.1);}
    @keyframes revealPrize {
      0% { transform: scale(1.2) rotate(4deg);}
      60%{ transform: scale(.88) rotate(-2deg);}
      90%{ transform: scale(1.03) rotate(0deg);}
      100%{transform: scale(1);}
    }
    canvas {
      position: absolute;
      width: 100%; height: 100%;
      left: 0; top: 0;
      border-radius: 22px;
      z-index: 3;
      touch-action: none;
      cursor: pointer;
    }
    .card-container::after {
      content: "";
      position: absolute;
      left: 15%; top: 14%;
      width: 70%; height: 36%;
      background: radial-gradient(circle at 55% 48%, #fffbe446 0, #fffbe400 100%);
      opacity: .91;
      border-radius: 44%;
      pointer-events: none;
      z-index: 0;
    }
    @media (max-width:500px) {
      .card-container { max-width: 97vw; }
    }
  </style>
</head>
<body>
  <div class="card-container">
    <div class="prize-text" id="prizeText"></div>
    <canvas id="scratchCanvas"></canvas>
  </div>
  <script>
    // Prize logic (50% for 1200, 30% for 1400, 20% for 1600)
    const prizes = [
      { amount: 1200, probability: 0.5 },
      { amount: 1400, probability: 0.3 },
      { amount: 1600, probability: 0.2 }
    ];
    function pickPrize() {
      let r = Math.random(), acc = 0;
      for (const p of prizes) {
        acc += p.probability;
        if (r <= acc) return p.amount;
      }
      return prizes[0].amount;
    }
    const amount = pickPrize();
    const prizeText = document.getElementById('prizeText');
    prizeText.textContent = `You won \u20B9${amount}! ðŸŽ‰`;

    // Responsive canvas setup
    const canvas = document.getElementById('scratchCanvas'), ctx = canvas.getContext('2d');
    const fit = () => {
      const card = canvas.parentElement.getBoundingClientRect();
      canvas.width = card.width;
      canvas.height = card.height;
      // Render gradient
      ctx.globalCompositeOperation = 'source-over';
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
      grad.addColorStop(0, "#ffe148");
      grad.addColorStop(1, "#ff2d2d");
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);
      // Subtle shine
      let r = Math.min(canvas.width,canvas.height)/1.13;
      let shine = ctx.createRadialGradient(
        canvas.width*.72,canvas.height*.22,0,
        canvas.width*.72,canvas.height*.22,r
      );
      shine.addColorStop(0, "#fffcee90");
      shine.addColorStop(1, "#ffe14800");
      ctx.fillStyle = shine;
      ctx.beginPath();
      ctx.arc(canvas.width*.72, canvas.height*.22, r, 0, 2*Math.PI);
      ctx.fill();
    };
    fit();
    window.addEventListener('resize', fit);

    // Scratch logic
    let isDrawing = false;
    let revealed = false;
    function getXY(e) {
      const r = canvas.getBoundingClientRect();
      if (e.touches) {
        return {
          x: e.touches[0].clientX - r.left,
          y: e.touches[0].clientY - r.top
        };
      }
      return { x: e.clientX - r.left, y: e.clientY - r.top };
    }
    function scratch(e) {
      if (!isDrawing || revealed) return;
      e.preventDefault();
      const {x, y} = getXY(e);
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, canvas.width*.13, 0, 2 * Math.PI);
      ctx.fill();
      ctx.closePath();
      ctx.globalCompositeOperation = 'source-over';
      if (getClearRatio() > .47) reveal();
    }
    canvas.addEventListener('mousedown', e => { isDrawing=true; scratch(e); });
    canvas.addEventListener('mouseup', ()=> isDrawing=false);
    canvas.addEventListener('mouseleave',()=> isDrawing=false);
    canvas.addEventListener('mousemove', scratch);
    canvas.addEventListener('touchstart', e=>{ isDrawing=true; scratch(e);});
    canvas.addEventListener('touchend', ()=> isDrawing=false);
    canvas.addEventListener('touchcancel',()=> isDrawing=false);
    canvas.addEventListener('touchmove', scratch);

    function reveal() {
      if (revealed) return;
      revealed = true;
      canvas.style.pointerEvents = 'none';
      setTimeout(() => prizeText.classList.add('prize-animate'), 200);
    }
    function getClearRatio() {
      const imgData = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      let clear = 0, total = imgData.length / 4;
      for (let i=3; i<imgData.length; i+=4) if (imgData[i] === 0) clear++;
      return clear/total;
    }
  </script>
</body>
</html>
